#include "flux.h"
#include <stdio.h>

#define e0 8.854e-12

int main() {
	vec vertices[] = {
	    // Side vertices (top then bottom per segment)
	    { 2.0000f,  3.0f,  0.0000f }, { 2.0000f, -3.0f,  0.0000f },
	    { 1.8478f,  3.0f,  0.7654f }, { 1.8478f, -3.0f,  0.7654f },
	    { 1.4142f,  3.0f,  1.4142f }, { 1.4142f, -3.0f,  1.4142f },
	    { 0.7654f,  3.0f,  1.8478f }, { 0.7654f, -3.0f,  1.8478f },
	    { 0.0000f,  3.0f,  2.0000f }, { 0.0000f, -3.0f,  2.0000f },
	    {-0.7654f,  3.0f,  1.8478f }, {-0.7654f, -3.0f,  1.8478f },
	    {-1.4142f,  3.0f,  1.4142f }, {-1.4142f, -3.0f,  1.4142f },
	    {-1.8478f,  3.0f,  0.7654f }, {-1.8478f, -3.0f,  0.7654f },
	    {-2.0000f,  3.0f,  0.0000f }, {-2.0000f, -3.0f,  0.0000f },
	    {-1.8478f,  3.0f, -0.7654f }, {-1.8478f, -3.0f, -0.7654f },
	    {-1.4142f,  3.0f, -1.4142f }, {-1.4142f, -3.0f, -1.4142f },
	    {-0.7654f,  3.0f, -1.8478f }, {-0.7654f, -3.0f, -1.8478f },
	    { 0.0000f,  3.0f, -2.0000f }, { 0.0000f, -3.0f, -2.0000f },
	    { 0.7654f,  3.0f, -1.8478f }, { 0.7654f, -3.0f, -1.8478f },
	    { 1.4142f,  3.0f, -1.4142f }, { 1.4142f, -3.0f, -1.4142f },
	    { 1.8478f,  3.0f, -0.7654f }, { 1.8478f, -3.0f, -0.7654f },

	    // Top center
	    { 0.0f,  3.0f, 0.0f },

	    // Bottom center
	    { 0.0f, -3.0f, 0.0f }
	};

	unsigned int index_buffer[] = {
	    // -------- Side faces (CCW, outward) --------
	     0,  2,  1,    1,  2,  3,
	     2,  4,  3,    3,  4,  5,
	     4,  6,  5,    5,  6,  7,
	     6,  8,  7,    7,  8,  9,
	     8, 10,  9,    9, 10, 11,
	    10, 12, 11,   11, 12, 13,
	    12, 14, 13,   13, 14, 15,
	    14, 16, 15,   15, 16, 17,
	    16, 18, 17,   17, 18, 19,
	    18, 20, 19,   19, 20, 21,
	    20, 22, 21,   21, 22, 23,
	    22, 24, 23,   23, 24, 25,
	    24, 26, 25,   25, 26, 27,
	    26, 28, 27,   27, 28, 29,
	    28, 30, 29,   29, 30, 31,
	    30,  0, 31,   31,  0,  1,

	    // -------- Top cap (CCW when viewed from +Y) --------
	    32,  2,  0,
	    32,  4,  2,
	    32,  6,  4,
	    32,  8,  6,
	    32, 10,  8,
	    32, 12, 10,
	    32, 14, 12,
	    32, 16, 14,
	    32, 18, 16,
	    32, 20, 18,
	    32, 22, 20,
	    32, 24, 22,
	    32, 26, 24,
	    32, 28, 26,
	    32, 30, 28,
	    32,  0, 30,

	    // -------- Bottom cap (CCW when viewed from -Y) --------
	    33,  1,  3,
	    33,  3,  5,
	    33,  5,  7,
	    33,  7,  9,
	    33,  9, 11,
	    33, 11, 13,
	    33, 13, 15,
	    33, 15, 17,
	    33, 17, 19,
	    33, 19, 21,
	    33, 21, 23,
	    33, 23, 25,
	    33, 25, 27,
	    33, 27, 29,
	    33, 29, 31,
	    33, 31,  1
	};
		
	double q_vals[] = {5.0, -3.0, 7.0};
	vec q_pos[] = { {0.3, -0.7, 0.8}, {-0.25, 0.43, -0.87}, {2.0, 3.0, 8.0} };
	int q_count = 3;

	int N = 1000;

	double net_flux = 0.0;
	for (int i = 0; i < sizeof(index_buffer) / sizeof(int); i += 3) {
		vec p1 = vertices[index_buffer[i + 0]];
		vec p2 = vertices[index_buffer[i + 1]];
		vec p3 = vertices[index_buffer[i + 2]];
		
		double flux = get_flux_through_triangle(p1, p2, p3, q_vals, q_pos, q_count, N);
		net_flux += flux;

		printf("Flux through triangle %d: %g\n", (i/3)+1, flux);
	}

	printf("Net flux through cube: %g\n", net_flux);

	double gauss_flux = (q_vals[0] + q_vals[1]) / e0;
	printf("Value of q/e0: %g\n", gauss_flux);

	return 0;
}

